<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin</title>
  <link rel="icon" type="image/png" href="icons/favicon.png">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
  <!-- Static Background -->
  <div class="image-background"></div>

  <!-- Header Logo -->
  <a href="menu.html" style="text-decoration: none; color: inherit;">
    <div class="header-logo">
      <div class="header-logo-image">
        <img src="icons/logo.png" alt="MarkLogic Logo" onerror="this.style.display='none'; this.parentElement.innerHTML='ðŸ“Š'">
      </div>
      <div class="header-brand">
        <div class="header-brand-name">MarkLogic</div>
        <div class="header-slogan">Stop Searching. Start Finding</div>
      </div>
    </div>
  </a>

  <!-- Admin Title Header (Next to User Icon) -->
  <div class="admin-title-header">
    <h1>Admin</h1>
  </div>

  <!-- User Icon -->
  <div class="user-icon" onclick="toggleUserDropdown()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
      <circle cx="12" cy="7" r="4"></circle>
    </svg>
  </div>

  <!-- User Dropdown Menu -->
  <div class="user-dropdown" id="userDropdown">
    <div class="user-dropdown-item" onclick="logout()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
        <polyline points="16 17 21 12 16 7"></polyline>
        <line x1="21" y1="12" x2="9" y2="12"></line>
      </svg>
      Log Out
    </div>
  </div>

  <!-- Main Container -->
  <div class="admin-container">
    <h1 class="admin-title">Admin</h1>

    <!-- Add User Button -->
    <div class="add-user-section">
      <button class="add-user-btn" onclick="openAddUserModal()">
        <i class="fa-solid fa-user-plus"></i>
        New User
      </button>
    </div>

    <!-- Users Table -->
    <div class="admin-table-container">
      <table class="users-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Password</th>
            <th>Role</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="usersTableBody">
          <tr>
            <td>Victoria Foo</td>
            <td>victoria.foo@skrine.com</td>
            <td>
              <div class="password-cell">
                <span class="password-text" data-password="password123">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>
                <i class="fa-solid fa-eye eye-icon" onclick="togglePassword(this)"></i>
              </div>
            </td>
            <td>
                <div class="admin-role-dropdown" data-index="0">
                    <div class="admin-role-select" onclick="toggleRoleDropdown(this)">
                        <span>Admin</span>
                        <i class="fa-solid fa-chevron-down dropdown-icon"></i>
                    </div>
                    <div class="admin-role-options">
                        <div class="admin-role-option selected" onclick="selectRole(this, 0, 'Admin')">Admin</div>
                        <div class="admin-role-option" onclick="selectRole(this, 0, 'User')">User</div>
                    </div>
                </div>
            </td>
            <td>
              <button class="admin-delete-btn" onclick="deleteUser(0)">
                <i class="fa-solid fa-trash"></i>
                Delete
              </button>
            </td>
          </tr>
          <tr>
            <td>Xian Xin</td>
            <td>xianxin@skrine.com</td>
            <td>
              <div class="password-cell">
                <span class="password-text" data-password="mypassword456">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>
                <i class="fa-solid fa-eye eye-icon" onclick="togglePassword(this)"></i>
              </div>
            </td>
            <td>
                <div class="admin-role-dropdown" data-index="0">
                    <div class="admin-role-select" onclick="toggleRoleDropdown(this)">
                        <span>Admin</span>
                        <i class="fa-solid fa-chevron-down dropdown-icon"></i>
                    </div>
                    <div class="admin-role-options">
                        <div class="admin-role-option selected" onclick="selectRole(this, 0, 'Admin')">Admin</div>
                        <div class="admin-role-option" onclick="selectRole(this, 0, 'User')">User</div>
                    </div>
                </div>
            </td>
            <td>
              <button class="admin-delete-btn" onclick="deleteUser(1)">
                <i class="fa-solid fa-trash"></i>
                Delete
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Add User Modal -->
  <div class="admin-modal-overlay" id="addUserModal">
    <div class="admin-modal-box">
      <h2 class="admin-modal-title">Add New User</h2>
      <form onsubmit="addUser(event)">
        <div class="form-group">
          <label class="form-label">Name</label>
          <input type="text" class="form-input" id="newUserName" placeholder="Enter name" required>
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="newUserEmail" placeholder="Enter email" required>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="newUserPassword" placeholder="Enter password" required>
        </div>
        <div class="form-group">
          <label class="form-label">Role</label>
          <div class="admin-role-dropdown" data-index="0">
            <div class="admin-role-select" onclick="toggleRoleDropdown(this)">
                <span>Admin</span>
                <i class="fa-solid fa-chevron-down dropdown-icon"></i>
            </div>
            <div class="admin-role-options">
                <div class="admin-role-option selected" onclick="selectRole(this, 0, 'Admin')">Admin</div>
                <div class="admin-role-option" onclick="selectRole(this, 0, 'User')">User</div>
             </div>
           </div>
        </div>
        <div class="admin-modal-buttons">
          <button type="button" class="admin-modal-btn admin-modal-btn-secondary" onclick="closeAddUserModal()">Cancel</button>
          <button type="submit" class="admin-modal-btn admin-modal-btn-primary">Add User</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Popup Notification -->
  <div class="admin-popup-notification" id="popup"></div>

  <script>
  // ==========================
  // User Data (In-Memory)
  // ==========================
  let users = [
    { name: 'Victoria Foo', email: 'victoria.foo@skrine.com', password: 'password123', role: 'Admin' },
    { name: 'Xian Xin', email: 'xianxin@skrine.com', password: 'mypassword456', role: 'User' }
  ];

  // ==========================
  // PASSWORD VISIBILITY
  // ==========================
  function togglePassword(icon) {
    const passwordText = icon.previousElementSibling;
    const actualPassword = passwordText.getAttribute('data-password');
    const isHidden = passwordText.textContent.includes('â€¢');

    if (isHidden) {
      passwordText.textContent = actualPassword;
      icon.className = 'fa-solid fa-eye-slash eye-icon';
    } else {
      passwordText.textContent = 'â€¢'.repeat(actualPassword.length);
      icon.className = 'fa-solid fa-eye eye-icon';
    }
  }

  // ==========================
  // USER DROPDOWN (TOP-RIGHT)
  // ==========================
  function toggleUserDropdown() {
    const dropdown = document.getElementById('userDropdown');
    dropdown.classList.toggle('show');
  }

  document.addEventListener('click', function(e) {
    const dropdown = document.getElementById('userDropdown');
    const userIcon = document.querySelector('.user-icon');
    if (!dropdown.contains(e.target) && !userIcon.contains(e.target)) {
      dropdown.classList.remove('show');
    }
  });

  function logout() {
    if (confirm('Are you sure you want to log out?')) {
      showPopup('Logging out...', 'success');
      setTimeout(() => {
        window.location.href = 'signin.html';
      }, 1000);
    }
  }

  // ==========================
  // ADD USER MODAL
  // ==========================
  function openAddUserModal() {
    document.getElementById('addUserModal').classList.add('show');
  }

  function closeAddUserModal() {
    document.getElementById('addUserModal').classList.remove('show');
    document.getElementById('newUserName').value = '';
    document.getElementById('newUserEmail').value = '';
    document.getElementById('newUserPassword').value = '';
    document.getElementById('newUserRole').value = 'User';
  }

  document.getElementById('addUserModal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeAddUserModal();
    }
  });

  // ==========================
  // USER MANAGEMENT
  // ==========================
  function addUser(event) {
    event.preventDefault();

    const name = document.getElementById('newUserName').value.trim();
    const email = document.getElementById('newUserEmail').value.trim();
    const password = document.getElementById('newUserPassword').value.trim();
    const role = document.getElementById('newUserRole').value;

    if (!name || !email || !password) {
      showPopup('Please fill in all fields.', 'error');
      return;
    }

    users.push({ name, email, password, role });
    renderUsers();
    closeAddUserModal();
    showPopup('User added successfully!', 'success');
  }

  function deleteUser(index) {
    if (confirm('Are you sure you want to delete this user?')) {
      users.splice(index, 1);
      renderUsers();
      showPopup('User deleted successfully!', 'success');
    }
  }

    // ==========================
    // CUSTOM ROLE DROPDOWN (Option 2 - Polished Version)
    // ==========================
    function toggleRoleDropdown(element) {
        const dropdown = element.closest('.admin-role-dropdown');
        const allDropdowns = document.querySelectorAll('.admin-role-dropdown');

        // Close all others
        allDropdowns.forEach(d => {
            if (d !== dropdown) d.classList.remove('show');
        });

        // Toggle this one
        dropdown.classList.toggle('show');
    }

    function selectRole(option, index, role) {
        const dropdown = option.closest('.admin-role-dropdown');

        // Update visual selection
        dropdown.querySelectorAll('.admin-role-option').forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
        dropdown.querySelector('.admin-role-select span').textContent = role;

        // Update user data
        users[index].role = role;
        showPopup(`Role updated to ${role}`, 'success');

        // Close dropdown
        dropdown.classList.remove('show');
    }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.admin-role-dropdown')) {
            document.querySelectorAll('.admin-role-dropdown').forEach(d => d.classList.remove('show'));
        }
    });


  // ==========================
  // RENDER USERS TABLE
  // ==========================
  function renderUsers() {
    const tbody = document.getElementById('usersTableBody');
    tbody.innerHTML = '';

    users.forEach((user, index) => {
      const maskedPassword = 'â€¢'.repeat(user.password.length);
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${user.name}</td>
        <td>${user.email}</td>
        <td>
          <div class="password-cell">
            <span class="password-text" data-password="${user.password}">${maskedPassword}</span>
            <i class="fa-solid fa-eye eye-icon" onclick="togglePassword(this)"></i>
          </div>
        </td>
        <td>
          <div class="admin-role-dropdown" data-index="${index}">
            <div class="admin-role-select" onclick="toggleRoleDropdown(this)">
              <span>${user.role}</span>
              <i class="fa-solid fa-chevron-down dropdown-icon"></i>
            </div>
            <div class="admin-role-options">
              <div class="admin-role-option ${user.role === 'Admin' ? 'selected' : ''}" onclick="selectRole(this, ${index}, 'Admin')">Admin</div>
              <div class="admin-role-option ${user.role === 'User' ? 'selected' : ''}" onclick="selectRole(this, ${index}, 'User')">User</div>
            </div>
          </div>
        </td>
        <td>
          <button class="admin-delete-btn" onclick="deleteUser(${index})">
            <i class="fa-solid fa-trash"></i>
            Delete
          </button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  // ==========================
  // POPUP NOTIFICATION
  // ==========================
  function showPopup(message, type = 'success') {
    const popup = document.getElementById('popup');
    popup.textContent = message;
    popup.className = `admin-popup-notification ${type}`;
    popup.classList.add('show');

    setTimeout(() => {
      popup.classList.remove('show');
    }, 3000);
  }

  // ==========================
  // INITIALIZE ON LOAD
  // ==========================
  document.addEventListener('DOMContentLoaded', renderUsers);
</script>

</body>
</html>